<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.loyd.dao.MypageDao">

	<select id="order_list" resultType="kr.co.loyd.dto.MypageDto">
		select ol.id, ol.watch_id, ol.member_id, ol.price, ol.discount, count, orderday, wt.picture, wt.name
		FROM `order list` ol
		LEFT JOIN `watch` wt
		ON wt.id = ol.watch_id
		LEFT JOIN `member` mb
		ON mb.id = ol.member_id
		WHERE mb.email = #{param1 } and ${param2 } like concat('%',#{param3 },'%')
		ORDER BY ol.id DESC
		LIMIT #{param4 }, 10
	</select>
	
	<select id="item_detail" resultType="kr.co.loyd.dto.MypageDto">
		SELECT *
		FROM `watch`
		WHERE id = #{param1 }
	</select>
	
	<select id="page_cnt" resultType="Integer">
		SELECT ceil(count(*) /10)
		FROM `order list`
	</select>
	
	<select id="enquiry" resultType="kr.co.loyd.dto.MypageDto">
		SELECT *
		FROM `qna`
		WHERE email = #{param1 }
	</select>
	
	<select id="enquiry_detail" resultType="kr.co.loyd.dto.MypageDto">
		SELECT *
		FROM `qna`
		WHERE id = #{param1 }
	</select>	
	
	<select id="wishlist" resultType="kr.co.loyd.dto.MypageDto">
		SELECT wl.id, wt.price, count, wt.name, wl.datetime, wt.picture
		FROM `wishlist` wl
		LEFT JOIN `watch` wt
		ON wt.id = wl.watch_id
		WHERE email = #{param1 }
	</select>
	
	<select id="member_edit" resultType="kr.co.loyd.dto.MemberDto">
		SELECT *
		FROM `member`
		WHERE email = #{email }
	</select>
	
	<update id="member_edit_ok" parameterType="kr.co.loyd.dto.MemberDto">
		UPDATE `member`
		SET name = #{name }, phone = #{phone }, email = #{email }
		WHERE id = #{id }
	</update>
	
	<select id="info" resultType="kr.co.loyd.dto.MypageDto">
		SELECT order_id, order_name, rec_name, pay, order_date
		FROM `order_detail` od
		LEFT JOIN `member` mb
		ON mb.email = od.email
		WHERE od.email = #{email }
	</select>
	
	<select id="order_detail" resultType="kr.co.loyd.dto.MypageDto">
		SELECT order_id, order_name, od.email, order_phone, rec_name, rec_phone, zip, addr1, addr2, pay, msg, order_date, mb.register_date, wt.picture, wt.name
		FROM `order_detail` od
		LEFT JOIN `member` mb
		ON mb.email = od.email
		LEFT JOIN `order list` ol
		ON ol.id = od.order_list_id
		LEFT JOIN `watch` wt
		ON wt.id = ol.watch_id
		WHERE od.email = #{email }
	</select>

</mapper>